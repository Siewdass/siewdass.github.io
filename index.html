<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BITCOIN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
			body {
				background: #6c757d;
			}
			.list-group-item {
				color: white;
				background: #343a40;
			}
			.navbar {
				background: #343a40 !important;
				margin-bottom: 15px;
				border-bottom-left-radius: 5px;
    		border-bottom-right-radius: 5px;
			}
			.navbar-brand {
				color: white;
			}
			#chart {
				background: #343a40;
				border-radius: 5px;
				margin-top: 15px;
			}
		</style>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.0/dist/chart.umd.min.js"></script>
  </head>
<body>

	<div class="container">
		<nav class="navbar navbar-expand-lg navbar-light bg-dark">
			<a class="navbar-brand mx-auto" href="#">BITCOIN</a>
		</nav>

		<ul class="list-group">
			<li id="price" class="list-group-item">PRICE: 0</li>
		</ul>

		<canvas id="chart"></canvas>
	</div>

	<script>
		const up = (ctx, value) => ctx.p0.skip || ctx.p1.skip ? 'green' : undefined;
		const down = (ctx, value) => ctx.p0.parsed.y > ctx.p1.parsed.y ? 'red' : undefined;

		const CHART = document.getElementById( 'chart' )
		const PRICE = document.getElementById( 'price' )

		const data = {
			labels: [ ],
			datasets: [ {
				lineTension: 0.3,
				data: [ ],
				borderColor: 'green',
				segment: {
					borderColor: ctx => up( ctx ) || down( ctx ),
					//borderDash: ctx => skipped(ctx, [6, 6]),
				},
			} ]
		}

		const options = {
			animation: { duration: 100 },
			plugins: { legend: { display: false } },
			scales: { y: { display: false }, x: { display: false } },
			fill: false,
			interaction: { intersect: false },
			radius: 0,
		}

		let chart = new Chart( CHART, { type: 'line', data, options } )

		setInterval( async function( ) {
			const res = await fetch( 'https://api.binance.com/api/v3/avgPrice?symbol=BTCUSDT' )
			const { price } = await res.json( )
			const date = new Date( )
			const time = `${date.getHours( )}:${date.getMinutes( )}:${date.getSeconds( )}`
			chart.data.datasets[ 0 ].data.push( parseFloat( price ) )
			chart.data.labels.push( time )
			if ( chart.data.datasets[ 0 ].data.length > 31 ) {
				chart.data.datasets[ 0 ].data.shift( )
				chart.data.labels.shift( )
			}
			PRICE.innerHTML = `PRICE: ${price}`
			chart.update( )
		}, 500 )

		/*const btc = new WebSocket( 'wss://stream.binance.com:9443/ws/btcusdt@trade' )
		let buyers = 0, sellers = 0
		btc.onmessage = async function( message ) {
			const { p, m, E } = JSON.parse( message.data )
		}*/
	</script>
</body>
</html>

