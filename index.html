<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BITCOIN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
			body {
				background: #6c757d;
			}
			.list-group-item {
				color: white;
				background: #343a40;
			}
			.navbar {
				background: #343a40 !important;
				margin-bottom: 20px;
			}
			.navbar-brand {
				color: white;
			}
			#chart {
				background: #343a40;
				border-radius: 10px;
				margin-top: 20px;
			}
		</style>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
<body>

	<nav class="navbar navbar-expand-lg navbar-light bg-dark">
		<div class="container">
			<a class="navbar-brand mx-auto" href="#">BITCOIN</a>
		</div>
	</nav>

	<div class="container">
		<ul class="list-group">
			<li id="bitcoin" class="list-group-item">PRICE: 0</li>
		</ul>

		<canvas id="chart"></canvas>
	</div>

	<script>
		Chart.defaults.color = "#ffffff";
		const CHART = document.getElementById( 'chart' )
		const BITCOIN = document.getElementById( 'bitcoin' )

		const data = {
			labels: [ ],
			datasets: [ {
				title: { text: null },
				lineTension: 0.3,
				scaleFontColor: "#FFFFFF",
				data: [ ],
				spanGaps: true
			} ]
		}

		let chart = new Chart( CHART, {
			type: 'line',
			data: data,
			options: {
				plugins: { legend: { display: false } },
				scales: { y: { display: false }, x: { display: false } } 
			}
		} )

		setInterval( async function fetchMovies( ) {
			const res = await fetch( 'https://api.binance.com/api/v3/avgPrice?symbol=BTCUSDT' )
			const { price } = await res.json( )
			const date = new Date( )
			const time = `${date.getHours( )}:${date.getMinutes( )}:${date.getSeconds( )}`
			chart.data.datasets[ 0 ].data.push( parseFloat( price ) )
			chart.data.labels.push( time )
			if ( chart.data.datasets[ 0 ].data.length > 30 ) {
				chart.data.datasets[ 0 ].data.shift( )
			} 
			if ( chart.data.labels.length > 31 ) {
				chart.data.labels.shift( )
			}
			BITCOIN.innerHTML = `BITCOIN: ${price}`
			chart.update( )
		}, 500 )

		/*const btc = new WebSocket( 'wss://stream.binance.com:9443/ws/btcusdt@trade' )
		btc.onmessage = async function( message ) {
			const { p, m, E } = JSON.parse( message.data ) 
		}*/
	</script>
</body>
</html>
